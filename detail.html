<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
  <title>The Emerald</title>
</head>

<body class="article">
	<div id="wrapper">
		<div class="main">

		</div> <!-- .content -->			
	</div> <!-- #wrapper -->
</body>	


  <script type="text/x-handlebars-template" id="storyDetail-tpl">
	<h2 class="title">{{{title}}}</h2>
	<div class="meta">
			<p> <span class="date">{{date}}</span> | <span class="byline">{{author}}</span> </p>
	</div>
	<div class="article-img">
		<img src="{{ thumbnail }}" alt="" />
	</div>
	<div class="content">
		{{{content}}}
	</div>
  </script>

<script type="text/x-handlebars-template" id="storyDetail-noImage-tpl">
	<h2 class="title">{{{title}}}</h2>
	<div class="meta">
			<p> <span class="date">{{date}}</span> | <span class="byline">{{author}}</span> </p>
	</div>
	<div class="content">
		{{{content}}}
	</div>
  </script>

  <script src="zepto.min.js"></script>
  <script src="handlebars.min.js"></script>
  <script src="moment.min.js"></script>

  <script>

	var storyDetail = Handlebars.compile($('#storyDetail-tpl').html());
	var storyDetailNoImage = Handlebars.compile($('#storyDetail-noImage-tpl').html());

	var storyURL = decodeURIComponent(window.location.href.split('=')[1]); //TODO: needs a sanity check here...
		
	$.ajax({
	  url: storyURL+'/json?callback=?',
	  dataType: 'script',
	  success: function(data) {
	    data.forEach(function(story) {	
			var storyHTML = "";
			story.timestamp = moment( story.date.split(" ").join("T") + "-07:00" );
			//story.date = story.timestamp.format("dddd, MMMM Do") + " at " + story.timestamp.format("h:mm a");
			 story.date = story.timestamp.format("MMM DD, YYYY");

			mixpanel.track("detail", {title: story.title}); //

		    if (typeof story.thumbnail === "string") {
				storyHTML = storyDetail(story);
			} else {
				storyHTML = storyDetailNoImage(story);
			}
		
			$(".main").css({"opacity":"0"})
			          .html(storyHTML)
			          .animate({"opacity":"1"}, 300);
			var url = "emeraldfootball:finishedLoading(true)"; // tell the UIWebView we're ready to rock and roll. removes the "Loading..." title
		    window.location = url;
		
			var wpcaptions = document.getElementsByClassName('wp-caption');
		    for(var i=0;i<wpcaptions.length;i++) {
		    	wpcaptions[i].removeAttribute("height");
		    	wpcaptions[i].removeAttribute("width");
		    	wpcaptions[i].removeAttribute("style");
		  	}

			  var imgs = document.getElementsByTagName('img');
			  for(var i=0;i<imgs.length;i++) {
			    imgs[i].removeAttribute("height");
			    imgs[i].removeAttribute("width");
			  }
		
		});
	  }
	});

	 $(document).ready(function() {
	   $('body').doubleTap(function(){
	     location.reload();
	    });
	 });

	  </script>
	<!-- start Mixpanel -->
	<script type="text/javascript">(function(c,a){window.mixpanel=a;var b,d,h,e;b=c.createElement("script");b.type="text/javascript";b.async=!0;b.src=("https:"===c.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.1.min.js';d=c.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d);a._i=[];a.init=function(b,c,f){function d(a,b){var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]);a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}var g=a;"undefined"!==typeof f?
	g=a[f]=[]:f="mixpanel";g.people=g.people||[];h="disable track track_pageview track_links track_forms register register_once unregister identify name_tag set_config people.identify people.set people.increment".split(" ");for(e=0;e<h.length;e++)d(g,h[e]);a._i.push([b,c,f])};a.__SV=1.1})(document,window.mixpanel||[]);
	mixpanel.init("420a1eeba431915f081f48dc71f7d951");
	</script>
	<!-- end Mixpanel -->
</html>