<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
  <title></title>
  <style type="text/css"> .feed .time { width: 100px; } </style>

</head>

<body class="home events" ontouchstart=""> <!-- Hack to be able to use :active -->
	<div id="wrapper">
		<div class="main">
		  <ul id="events-ul" class="feed clearfix">
			
			<li class="arts">
				<a href="#">
			    	<h2>Loading events...</h2>
			    	<span class="date"></span>
			    	<span class="time"></span>
			    	<span class="location"></span>
			    </a>
			</li>
		
		  </ul>
			
		</div> <!-- .content -->			
	</div> <!-- #wrapper -->
</body>	

  <script src="zepto.min.js"></script>
  <script src="handlebars.min.js"></script>
  <script src="moment.min.js"></script>

  <script type="text/x-handlebars-template" id="event-tpl">
    <li class="{{category}}">
		<a href="#">
	    	<h2>{{title}}</h2>
	    	<span class="date">{{displayDate}}</span>
	    	<span class="time">{{displayTime}}</span>
	    	<span class="location">{{location}}</span>
	    </a>
	</li>
  </script>

  <script type="text/javascript">

	var templateSource = $('#event-tpl').html();
	var template = Handlebars.compile(templateSource);

	var makeDisplayDate = function(start_time, end_time) {
		var start_time = new Date(start_time);
		var end_time = new Date(end_time);
		return { 
			displayDate: moment(start_time).format("MMM YY"),
			displayTime: moment(start_time).format("h:mma") + " - " + moment(end_time).format("h:mma") 
		};
	}

    var setupStory = function(story) {	
	    var displayStuff = makeDisplayDate(story.start_time, story.end_time);
		story.displayDate = displayStuff.displayDate; // this is ugly.
		story.displayTime = displayStuff.displayTime;
		return story;
	}

    var buildPage = function(events) {  
		$("#events-ul").html("");
		events.forEach(function(story) {
			var storyHTML = template(setupStory(story));
			$("#events-ul").append(storyHTML);		
		});
    }
	
    $(document).on('click', 'body', function(e) {
	  e.preventDefault();
	  return false;
	});

  </script>

  <script src="http://dev.dailyemerald.com:3000/events.json?callback=buildPage"></script>

</html>