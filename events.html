<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
  <link rel="stylesheet" href="css/style.css">
  <title></title>
  <style type="text/css"> .feed .time { width: 100px; } </style>

</head>

<body class="home events" ontouchstart=""> <!-- Hack to be able to use :active -->
	<div id="wrapper">
		<div class="main">
				  <p class="beta">Beta</p>
		  <ul id="events-ul" class="feed clearfix">
			<li class="arts">
				<a href="#">
			    	<h2>Loading events...</h2>
			    	<span class="date"></span>
			    	<span class="time"></span>
			    	<span class="location"></span>
			    </a>
			</li>
		
		  </ul>
			
		</div> <!-- .content -->			
	</div> <!-- #wrapper -->
</body>	

  <script src="zepto.min.js"></script>
  <script src="handlebars.min.js"></script>
  <script src="moment.min.js"></script>

  <script type="text/x-handlebars-template" id="event-tpl">
    <li class="{{category}}">
		<a href="#">
	    	<h2>{{title}}</h2>
	    	<span class="date">{{displayDate}}</span>
	    	<span class="time">{{displayTime}}</span>
	    	<span class="location">{{location}}</span>
	    </a>
	</li>
  </script>

  <script type="text/javascript">

	var templateSource = $('#event-tpl').html();
	var template = Handlebars.compile(templateSource);

	var makeDisplayDate = function(start_time, end_time) {
		var start_time = new Date(start_time);
		var end_time = new Date(end_time);
		return { 
			displayDate: moment(start_time).format("MMM DD"),
			displayTime: moment(start_time).format("h:mma") + " - " + moment(end_time).format("h:mma") 
		};
	}

    var setupStory = function(story) {	
	    var displayStuff = makeDisplayDate(story.start_time, story.end_time);
		story.displayDate = displayStuff.displayDate; // this is ugly.
		story.displayTime = displayStuff.displayTime;
		return story;
	}

    var buildPage = function(events) {  
		$("#events-ul").html("");
		events.forEach(function(story) {
			var storyHTML = template(setupStory(story));
			$("#events-ul").append(storyHTML);		
		});
    }
	
    $(document).on('click', 'body', function(e) {
	  e.preventDefault();
	  return false;
	});

  </script>

  <script src="http://events.dailyemerald.com/events.json?callback=buildPage"></script>

<!-- start Mixpanel -->
<script type="text/javascript">(function(c,a){window.mixpanel=a;var b,d,h,e;b=c.createElement("script");b.type="text/javascript";b.async=!0;b.src=("https:"===c.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.1.min.js';d=c.getElementsByTagName("script")[0];d.parentNode.insertBefore(b,d);a._i=[];a.init=function(b,c,f){function d(a,b){var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]);a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}var g=a;"undefined"!==typeof f?
g=a[f]=[]:f="mixpanel";g.people=g.people||[];h="disable track track_pageview track_links track_forms register register_once unregister identify name_tag set_config people.identify people.set people.increment".split(" ");for(e=0;e<h.length;e++)d(g,h[e]);a._i.push([b,c,f])};a.__SV=1.1})(document,window.mixpanel||[]);
mixpanel.init("420a1eeba431915f081f48dc71f7d951");
mixpanel.track("events");
</script>
<!-- end Mixpanel -->

</html>